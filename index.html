import React, { useState, useEffect, useCallback } from 'react';
import { initializeApp } from 'firebase/app';
import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from 'firebase/auth';
import { getFirestore, doc, setDoc, collection, query, getDocs } from 'firebase/firestore';

// Ensure Tailwind CSS is loaded (assuming it's available in the environment)
// No explicit import for Tailwind needed in React component itself, just ensure the script is in HTML.

function App() {
    // Firebase initialization and authentication
    const [db, setDb] = useState(null);
    const [auth, setAuth] = useState(null);
    const [userId, setUserId] = useState(null);
    const [isAuthReady, setIsAuthReady] = useState(false);
    const [loading, setLoading] = useState(false);
    const [message, setMessage] = useState('');
    const [showSavedInvoices, setShowSavedInvoices] = useState(false);
    const [savedInvoices, setSavedInvoices] = useState([]);

    // Invoice state
    const [invoiceDetails, setInvoiceDetails] = useState({
        invoiceNumber: '',
        invoiceDate: new Date().toISOString().slice(0, 10),
        dueDate: new Date(new Date().setDate(new Date().getDate() + 7)).toISOString().slice(0, 10), // 7 days from now
        companyName: 'Your Company Name',
        companyAddress: '123 Business Rd, City, State, ZIP',
        clientName: 'Client Name',
        clientAddress: '456 Client St, City, State, ZIP',
    });

    const [items, setItems] = useState([
        { id: 1, description: 'Service/Product 1', quantity: 1, unitPrice: 100.00 },
    ]);

    const [subtotal, setSubtotal] = useState(0);
    const [taxRate, setTaxRate] = useState(10); // 10% tax rate
    const [taxAmount, setTaxAmount] = useState(0);
    const [total, setTotal] = useState(0);

    // Initialize Firebase and set up auth listener
    useEffect(() => {
        try {
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};

            if (Object.keys(firebaseConfig).length === 0) {
                console.error("Firebase config is missing. Cannot initialize Firebase.");
                setMessage("Error: Firebase configuration missing.");
                return;
            }

            const app = initializeApp(firebaseConfig);
            const firestore = getFirestore(app);
            const firebaseAuth = getAuth(app);

            setDb(firestore);
            setAuth(firebaseAuth);

            // Sign in anonymously or with custom token
            const initialAuth = async () => {
                try {
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                        await signInWithCustomToken(firebaseAuth, __initial_auth_token);
                    } else {
                        await signInAnonymously(firebaseAuth);
                    }
                } catch (error) {
                    console.error("Firebase authentication error:", error);
                    setMessage(`Authentication error: ${error.message}`);
                }
            };

            initialAuth();

            // Listen for auth state changes
            const unsubscribe = onAuthStateChanged(firebaseAuth, (user) => {
                if (user) {
                    setUserId(user.uid);
                    setIsAuthReady(true);
                    setMessage('Authenticated successfully.');
                } else {
                    setUserId(null);
                    setIsAuthReady(true); // Still ready, just not authenticated
                    setMessage('Not authenticated. Using anonymous access.');
                }
            });

            return () => unsubscribe(); // Cleanup auth listener
        } catch (error) {
            console.error("Failed to initialize Firebase:", error);
            setMessage(`Firebase init error: ${error.message}`);
        }
    }, []);

    // Calculate totals whenever items or tax rate change
    useEffect(() => {
        let currentSubtotal = items.reduce((sum, item) => sum + (item.quantity * item.unitPrice), 0);
        let currentTaxAmount = currentSubtotal * (taxRate / 100);
        let currentTotal = currentSubtotal + currentTaxAmount;

        setSubtotal(currentSubtotal);
        setTaxAmount(currentTaxAmount);
        setTotal(currentTotal);
    }, [items, taxRate]);

    // Handle input changes for invoice details
    const handleInvoiceDetailsChange = (e) => {
        const { name, value } = e.target;
        setInvoiceDetails(prev => ({ ...prev, [name]: value }));
    };

    // Handle item input changes
    const handleItemChange = (id, field, value) => {
        setItems(prevItems =>
            prevItems.map(item =>
                item.id === id ? { ...item, [field]: field === 'quantity' || field === 'unitPrice' ? parseFloat(value) || 0 : value } : item
            )
        );
    };

    // Add a new item row
    const addItem = () => {
        setItems(prevItems => [
            ...prevItems,
            { id: prevItems.length > 0 ? Math.max(...prevItems.map(item => item.id)) + 1 : 1, description: '', quantity: 1, unitPrice: 0.00 }
        ]);
    };

    // Remove an item row
    const removeItem = (id) => {
        setItems(prevItems => prevItems.filter(item => item.id !== id));
    };

    // Display message for a short period
    const showTemporaryMessage = (msg, duration = 3000) => {
        setMessage(msg);
        const timer = setTimeout(() => {
            setMessage('');
        }, duration);
        return () => clearTimeout(timer); // Cleanup function for useEffect
    };

    // Copy invoice content to clipboard
    const copyInvoice = () => {
        const invoiceContentDiv = document.getElementById('invoice-preview');
        if (invoiceContentDiv) {
            const range = document.createRange();
            range.selectNode(invoiceContentDiv);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
            try {
                document.execCommand('copy');
                window.getSelection().removeAllRanges();
                showTemporaryMessage('Invoice copied to clipboard!');
            } catch (err) {
                console.error('Failed to copy invoice: ', err);
                showTemporaryMessage('Failed to copy invoice.');
            }
        } else {
            showTemporaryMessage('Invoice content not found for copying.');
        }
    };

    // Save invoice to Firestore
    const saveInvoice = async () => {
        if (!isAuthReady || !db || !userId) {
            showTemporaryMessage('Authentication not ready. Cannot save invoice.');
            return;
        }

        setLoading(true);
        try {
            const invoiceToSave = {
                ...invoiceDetails,
                items: items,
                subtotal: subtotal,
                taxRate: taxRate,
                taxAmount: taxAmount,
                total: total,
                createdAt: new Date().toISOString(),
                userId: userId,
            };

            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const invoiceDocRef = doc(db, `/artifacts/${appId}/users/${userId}/invoices`, invoiceDetails.invoiceNumber || `invoice-${Date.now()}`);
            await setDoc(invoiceDocRef, invoiceToSave);
            showTemporaryMessage('Invoice saved successfully!');
            setLoading(false);
        } catch (error) {
            console.error('Error saving invoice:', error);
            showTemporaryMessage(`Error saving invoice: ${error.message}`);
            setLoading(false);
        }
    };

    // Fetch saved invoices
    const fetchSavedInvoices = useCallback(async () => {
        if (!isAuthReady || !db || !userId) {
            showTemporaryMessage('Authentication not ready. Cannot fetch invoices.');
            return;
        }

        setLoading(true);
        try {
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const invoicesCollectionRef = collection(db, `/artifacts/${appId}/users/${userId}/invoices`);
            const q = query(invoicesCollectionRef);
            const querySnapshot = await getDocs(q);
            const fetchedInvoices = [];
            querySnapshot.forEach((doc) => {
                fetchedInvoices.push({ id: doc.id, ...doc.data() });
            });
            setSavedInvoices(fetchedInvoices);
            showTemporaryMessage('Saved invoices loaded.');
            setLoading(false);
        } catch (error) {
            console.error('Error fetching saved invoices:', error);
            showTemporaryMessage(`Error fetching saved invoices: ${error.message}`);
            setLoading(false);
        }
    }, [isAuthReady, db, userId]);

    useEffect(() => {
        if (showSavedInvoices && isAuthReady && db && userId) {
            fetchSavedInvoices();
        }
    }, [showSavedInvoices, isAuthReady, db, userId, fetchSavedInvoices]);

    // Load a selected invoice from the list
    const loadInvoice = (invoice) => {
        setInvoiceDetails({
            invoiceNumber: invoice.invoiceNumber,
            invoiceDate: invoice.invoiceDate,
            dueDate: invoice.dueDate,
            companyName: invoice.companyName,
            companyAddress: invoice.companyAddress,
            clientName: invoice.clientName,
            clientAddress: invoice.clientAddress,
        });
        setItems(invoice.items);
        setTaxRate(invoice.taxRate);
        setShowSavedInvoices(false); // Hide the list after loading
        showTemporaryMessage(`Invoice ${invoice.invoiceNumber} loaded.`);
    };

    // AI Feature: Generate Invoice Number
    const generateInvoiceNumber = async () => {
        setLoading(true);
        try {
            const prompt = "Generate a unique, professional, and sequential invoice number. It should be short and include the current year. Example: INV-2025-001.";
            const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };
            const apiKey = ""; // Canvas will provide this if empty
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const result = await response.json();

            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                const text = result.candidates[0].content.parts[0].text;
                setInvoiceDetails(prev => ({ ...prev, invoiceNumber: text.trim() }));
                showTemporaryMessage('AI generated invoice number.');
            } else {
                showTemporaryMessage('AI could not generate an invoice number.');
            }
        } catch (error) {
            console.error('Error generating invoice number with AI:', error);
            showTemporaryMessage(`AI error: ${error.message}`);
        } finally {
            setLoading(false);
        }
    };

    // AI Feature: Generate Item Description
    const generateItemDescription = async (itemId, currentDescription) => {
        setLoading(true);
        try {
            const prompt = `Elaborate on this invoice item description: "${currentDescription}". Make it professional and concise, suitable for an invoice.`;
            const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };
            const apiKey = ""; // Canvas will provide this if empty
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const result = await response.json();

            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                const text = result.candidates[0].content.parts[0].text;
                setItems(prevItems =>
                    prevItems.map(item =>
                        item.id === itemId ? { ...item, description: text.trim() } : item
                    )
                );
                showTemporaryMessage('AI generated item description.');
            } else {
                showTemporaryMessage('AI could not generate item description.');
            }
        } catch (error) {
            console.error('Error generating item description with AI:', error);
            showTemporaryMessage(`AI error: ${error.message}`);
        } finally {
            setLoading(false);
        }
    };

    return (
        <div className="min-h-screen bg-gray-100 p-4 font-inter flex flex-col items-center">
            {/* Loading and Message Overlay */}
            {(loading || message) && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div className="bg-white p-6 rounded-lg shadow-xl flex flex-col items-center">
                        {loading && (
                            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mb-4"></div>
                        )}
                        <p className="text-lg font-semibold text-gray-800">{message}</p>
                        {userId && (
                            <p className="text-sm text-gray-600 mt-2">User ID: {userId}</p>
                        )}
                    </div>
                </div>
            )}

            <div className="bg-white rounded-lg shadow-lg p-6 md:p-8 w-full max-w-4xl mb-8">
                <h1 className="text-3xl font-bold text-gray-800 mb-6 text-center">Smart AI Invoice Generator</h1>

                {/* Invoice Details Section */}
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div>
                        <label className="block text-gray-700 text-sm font-bold mb-2">Invoice Number:</label>
                        <div className="flex items-center">
                            <input
                                type="text"
                                name="invoiceNumber"
                                value={invoiceDetails.invoiceNumber}
                                onChange={handleInvoiceDetailsChange}
                                className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline flex-grow"
                            />
                            <button
                                onClick={generateInvoiceNumber}
                                className="ml-2 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full shadow-md transition duration-300 ease-in-out"
                                disabled={loading}
                                title="Generate Invoice Number with AI"
                            >
                                <svg className="w-5 h-5 inline-block" fill="currentColor" viewBox="0 0 20 20">
                                    <path fillRule="evenodd" d="M6.672 1.911a1.102 1.102 0 011.053-.743h4.15a1.102 1.102 0 011.053.743l1.404 4.195a1.102 1.102 0 01-.482 1.343l-1.956 1.129a1.102 1.102 0 00-.482 1.343l1.404 4.195a1.102 1.102 0 01-1.053.743h-4.15a1.102 1.102 0 01-1.053-.743l-1.404-4.195a1.102 1.102 0 01.482-1.343l1.956-1.129a1.102 1.102 0 00.482-1.343l-1.404-4.195zM10 12a2 2 0 100-4 2 2 0 000 4z" clipRule="evenodd" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div>
                        <label className="block text-gray-700 text-sm font-bold mb-2">Invoice Date:</label>
                        <input
                            type="date"
                            name="invoiceDate"
                            value={invoiceDetails.invoiceDate}
                            onChange={handleInvoiceDetailsChange}
                            className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        />
                    </div>
                    <div>
                        <label className="block text-gray-700 text-sm font-bold mb-2">Due Date:</label>
                        <input
                            type="date"
                            name="dueDate"
                            value={invoiceDetails.dueDate}
                            onChange={handleInvoiceDetailsChange}
                            className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        />
                    </div>
                </div>

                {/* Company and Client Details */}
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div>
                        <h2 className="text-xl font-semibold text-gray-700 mb-4">Your Company Info</h2>
                        <label className="block text-gray-700 text-sm font-bold mb-2">Company Name:</label>
                        <input
                            type="text"
                            name="companyName"
                            value={invoiceDetails.companyName}
                            onChange={handleInvoiceDetailsChange}
                            className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline mb-3"
                        />
                        <label className="block text-gray-700 text-sm font-bold mb-2">Company Address:</label>
                        <textarea
                            name="companyAddress"
                            value={invoiceDetails.companyAddress}
                            onChange={handleInvoiceDetailsChange}
                            className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline h-24"
                        ></textarea>
                    </div>
                    <div>
                        <h2 className="text-xl font-semibold text-gray-700 mb-4">Bill To</h2>
                        <label className="block text-gray-700 text-sm font-bold mb-2">Client Name:</label>
                        <input
                            type="text"
                            name="clientName"
                            value={invoiceDetails.clientName}
                            onChange={handleInvoiceDetailsChange}
                            className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline mb-3"
                        />
                        <label className="block text-gray-700 text-sm font-bold mb-2">Client Address:</label>
                        <textarea
                            name="clientAddress"
                            value={invoiceDetails.clientAddress}
                            onChange={handleInvoiceDetailsChange}
                            className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline h-24"
                        ></textarea>
                    </div>
                </div>

                {/* Invoice Items Section */}
                <h2 className="text-xl font-semibold text-gray-700 mb-4">Items</h2>
                <div className="overflow-x-auto mb-6">
                    <table className="min-w-full bg-white rounded-lg shadow-md">
                        <thead>
                            <tr className="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                                <th className="py-3 px-6 text-left">Description</th>
                                <th className="py-3 px-6 text-center">Quantity</th>
                                <th className="py-3 px-6 text-center">Unit Price</th>
                                <th className="py-3 px-6 text-right">Amount</th>
                                <th className="py-3 px-6 text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody className="text-gray-600 text-sm font-light">
                            {items.map(item => (
                                <tr key={item.id} className="border-b border-gray-200 hover:bg-gray-100">
                                    <td className="py-3 px-6 text-left flex items-center">
                                        <input
                                            type="text"
                                            value={item.description}
                                            onChange={(e) => handleItemChange(item.id, 'description', e.target.value)}
                                            className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline mr-2"
                                        />
                                        <button
                                            onClick={() => generateItemDescription(item.id, item.description)}
                                            className="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-3 rounded-full shadow-md transition duration-300 ease-in-out text-xs"
                                            disabled={loading}
                                            title="Generate Description with AI"
                                        >
                                            AI
                                        </button>
                                    </td>
                                    <td className="py-3 px-6 text-center">
                                        <input
                                            type="number"
                                            value={item.quantity}
                                            onChange={(e) => handleItemChange(item.id, 'quantity', e.target.value)}
                                            className="shadow appearance-none border rounded w-20 py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline text-center"
                                            min="0"
                                        />
                                    </td>
                                    <td className="py-3 px-6 text-center">
                                        <input
                                            type="number"
                                            value={item.unitPrice.toFixed(2)}
                                            onChange={(e) => handleItemChange(item.id, 'unitPrice', e.target.value)}
                                            className="shadow appearance-none border rounded w-24 py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline text-center"
                                            step="0.01"
                                            min="0"
                                        />
                                    </td>
                                    <td className="py-3 px-6 text-right">${(item.quantity * item.unitPrice).toFixed(2)}</td>
                                    <td className="py-3 px-6 text-center">
                                        <button
                                            onClick={() => removeItem(item.id)}
                                            className="bg-red-500 hover:bg-red-700 text-white font-bold py-1 px-2 rounded-full shadow-md transition duration-300 ease-in-out text-xs"
                                        >
                                            Remove
                                        </button>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
                <button
                    onClick={addItem}
                    className="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-full shadow-md transition duration-300 ease-in-out mb-8"
                >
                    Add Item
                </button>

                {/* Totals Section */}
                <div className="flex justify-end mb-8">
                    <div className="w-full md:w-1/2">
                        <div className="flex justify-between mb-2">
                            <span className="text-gray-700">Subtotal:</span>
                            <span className="font-semibold">${subtotal.toFixed(2)}</span>
                        </div>
                        <div className="flex justify-between mb-2">
                            <label className="text-gray-700">Tax Rate (%):</label>
                            <input
                                type="number"
                                value={taxRate}
                                onChange={(e) => setTaxRate(parseFloat(e.target.value) || 0)}
                                className="shadow appearance-none border rounded w-20 py-1 px-2 text-gray-700 leading-tight focus:outline-none focus:shadow-outline text-right"
                                min="0"
                                max="100"
                            />
                        </div>
                        <div className="flex justify-between mb-2">
                            <span className="text-gray-700">Tax Amount:</span>
                            <span className="font-semibold">${taxAmount.toFixed(2)}</span>
                        </div>
                        <div className="flex justify-between border-t-2 border-gray-300 pt-2 mt-2">
                            <span className="text-gray-800 text-lg font-bold">Total:</span>
                            <span className="text-gray-800 text-lg font-bold">${total.toFixed(2)}</span>
                        </div>
                    </div>
                </div>

                {/* Action Buttons */}
                <div className="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4">
                    <button
                        onClick={copyInvoice}
                        className="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105"
                    >
                        Copy Invoice
                    </button>
                    <button
                        onClick={saveInvoice}
                        className="bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105"
                        disabled={loading}
                    >
                        Save Invoice
                    </button>
                    <button
                        onClick={() => setShowSavedInvoices(prev => !prev)}
                        className="bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105"
                    >
                        {showSavedInvoices ? 'Hide Saved Invoices' : 'View Saved Invoices'}
                    </button>
                </div>
            </div>

            {/* Saved Invoices List */}
            {showSavedInvoices && (
                <div className="bg-white rounded-lg shadow-lg p-6 md:p-8 w-full max-w-4xl mt-8">
                    <h2 className="text-2xl font-bold text-gray-800 mb-6 text-center">Your Saved Invoices</h2>
                    {savedInvoices.length === 0 ? (
                        <p className="text-center text-gray-600">No invoices saved yet.</p>
                    ) : (
                        <div className="overflow-x-auto">
                            <table className="min-w-full bg-white rounded-lg shadow-md">
                                <thead>
                                    <tr className="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                                        <th className="py-3 px-6 text-left">Invoice #</th>
                                        <th className="py-3 px-6 text-left">Client Name</th>
                                        <th className="py-3 px-6 text-right">Total</th>
                                        <th className="py-3 px-6 text-center">Saved On</th>
                                        <th className="py-3 px-6 text-center">Actions</th>
                                    </tr>
                                </thead>
                                <tbody className="text-gray-600 text-sm font-light">
                                    {savedInvoices.map((invoice) => (
                                        <tr key={invoice.id} className="border-b border-gray-200 hover:bg-gray-100">
                                            <td className="py-3 px-6 text-left">{invoice.invoiceNumber}</td>
                                            <td className="py-3 px-6 text-left">{invoice.clientName}</td>
                                            <td className="py-3 px-6 text-right">${invoice.total.toFixed(2)}</td>
                                            <td className="py-3 px-6 text-center">{new Date(invoice.createdAt).toLocaleDateString()}</td>
                                            <td className="py-3 px-6 text-center">
                                                <button
                                                    onClick={() => loadInvoice(invoice)}
                                                    className="bg-blue-500 hover:bg-blue-700 text-white font-bold py-1 px-3 rounded-full shadow-md transition duration-300 ease-in-out text-xs"
                                                >
                                                    Load
                                                </button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    )}
                </div>
            )}


            {/* Hidden div for copying invoice content */}
            <div id="invoice-preview" className="absolute left-[-9999px] top-[-9999px] w-[210mm] p-6 bg-white border border-gray-300 text-black text-sm" style={{ fontFamily: 'Inter, sans-serif' }}>
                <h1 className="text-2xl font-bold text-center mb-4">INVOICE</h1>
                <div className="flex justify-between mb-6">
                    <div>
                        <p className="font-bold">{invoiceDetails.companyName}</p>
                        <p>{invoiceDetails.companyAddress.split('\n').map((line, i) => <span key={i}>{line}<br/></span>)}</p>
                    </div>
                    <div className="text-right">
                        <p><span className="font-bold">Invoice #:</span> {invoiceDetails.invoiceNumber}</p>
                        <p><span className="font-bold">Date:</span> {invoiceDetails.invoiceDate}</p>
                        <p><span className="font-bold">Due Date:</span> {invoiceDetails.dueDate}</p>
                    </div>
                </div>

                <div className="mb-6">
                    <p className="font-bold">Bill To:</p>
                    <p>{invoiceDetails.clientName}</p>
                    <p>{invoiceDetails.clientAddress.split('\n').map((line, i) => <span key={i}>{line}<br/></span>)}</p>
                </div>

                <table className="w-full mb-6 border-collapse">
                    <thead>
                        <tr className="bg-gray-100 border-b border-t border-gray-300">
                            <th className="py-2 px-4 text-left">Description</th>
                            <th className="py-2 px-4 text-center">Qty</th>
                            <th className="py-2 px-4 text-right">Unit Price</th>
                            <th className="py-2 px-4 text-right">Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        {items.map(item => (
                            <tr key={item.id} className="border-b border-gray-200">
                                <td className="py-2 px-4 text-left">{item.description}</td>
                                <td className="py-2 px-4 text-center">{item.quantity}</td>
                                <td className="py-2 px-4 text-right">${item.unitPrice.toFixed(2)}</td>
                                <td className="py-2 px-4 text-right">${(item.quantity * item.unitPrice).toFixed(2)}</td>
                            </tr>
                        ))}
                    </tbody>
                </table>

                <div className="flex justify-end">
                    <div className="w-1/2">
                        <div className="flex justify-between mb-1">
                            <span>Subtotal:</span>
                            <span className="font-bold">${subtotal.toFixed(2)}</span>
                        </div>
                        <div className="flex justify-between mb-1">
                            <span>Tax ({taxRate}%):</span>
                            <span className="font-bold">${taxAmount.toFixed(2)}</span>
                        </div>
                        <div className="flex justify-between border-t border-gray-300 pt-2 mt-2">
                            <span className="text-lg font-bold">Total:</span>
                            <span className="text-lg font-bold">${total.toFixed(2)}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    );
}

export default App;
